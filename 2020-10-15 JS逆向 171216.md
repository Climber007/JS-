



### 02 深入理解 JavaScript 反爬虫的根本原因

![img](G:\rjdata\youdaoyun\syppp520@163.com\5c51fe3341fe442c8571470b9e0012cf\clipboard.png)

#### **1. 网页基本构成**

![img](G:\rjdata\youdaoyun\syppp520@163.com\d8fdf195d3f34236ab9dc7583447079b\clipboard.png)



src = 资源路径

#### **2. 浏览器组件和作用**

![img](G:\rjdata\youdaoyun\syppp520@163.com\b3a3b87c255540a99c853a6862e808d0\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\42c0a94223f1446e9e660e90ab16c6de\clipboard.png)



**本质：CSS和html改变的是浏览器中的Dom排版内容（显示）；html没有发生变化**



#### **3. HTML DOM 与网页渲染过程**



![img](G:\rjdata\youdaoyun\syppp520@163.com\68e189d25f3f457f82c76aad0a0f1a2f\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\5469c00c4a494ed7873fe8802094b539\clipboard.png)









#### **4. 编程语言或工具与浏览器的差异**

浏览器有HTML/JS/CSS解释器；其他工具中没有JS解释器；css和JS的情况是一样的；可以利用工具中没有CSS解释器和渲染引擎的特点来实现反爬虫；

**应用**: **字体反爬虫、文本偏移反爬虫、文本混淆反爬虫等反爬虫手段**；





### 03 了解工作中常用的 JavaScript 语法和知识

#### 1.JS简介-与CSS和HTML之间的关系

![img](G:\rjdata\youdaoyun\syppp520@163.com\a3bde96a3a934792b3c009e6e449283b\clipboard.png)





![img](G:\rjdata\youdaoyun\syppp520@163.com\c52291cb856e4e3dadf03f3f883ceaf3\clipboard.png)

#### 2.JS语法-数据类型

![img](G:\rjdata\youdaoyun\syppp520@163.com\92c592720a6443e3960ef87fa9a7eea0\clipboard.png)





![img](G:\rjdata\youdaoyun\syppp520@163.com\0b40a0e4593647fdb496a553c11b72d1\clipboard.png)





![img](G:\rjdata\youdaoyun\syppp520@163.com\270c44390cd34001bc3cdeaeb9b60868\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\e57e7844b30f439fb776517038a3ceb6\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\06d39565ed2f4f7b9cc7c70b5f1061a8\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\1c4a0debb0634754ad3a13b07d256002\clipboard.png)

#### 3.JS语法-控制流

![img](G:\rjdata\youdaoyun\syppp520@163.com\fa907f590562446ebceb1cf6c83327e5\clipboard.png)



重点：

#### 4.JS语法-函数

![img](G:\rjdata\youdaoyun\syppp520@163.com\98bf7c90d90243b4bf835a38afb8c8ce\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\f7015c7dd54d43ddbd1d8bedcbe2b89c\clipboard.png)



**function**是函数的定义，是一个独立的作用域，其中定义的变量在函数外不可见。 **var a = 100 可以提升声明，也可以突破非函数的块作用域。** **a = 100 隐式声明不能提升声明，在“严格模式”下会出错，但是可以把变量隐式声明为全局变量。建议少用。**  let a = 100 不能提升声明，而且不能突破任何的块作用域。推荐使用。

// 函数中变量的作用域 function test() {     a = 100;     var b = 200;     let c = 300; } // 先要运行test函数 test()  console.log(a); console.log(b); // 不可见 console.log(c); // 不可见,出不了函数块；  // 块作用域中变量 if (1) {     a = 100;     var b = 200;  // 块作用域的提升 ；     let c = 300; } console.log(a); console.log(b); console.log(c); // 不可见 



![img](G:\rjdata\youdaoyun\syppp520@163.com\5ba5d9007bc0402982418cd69810ba89\clipboard.png)

#### 5.JS语法-闭包

![img](G:\rjdata\youdaoyun\syppp520@163.com\98ec58db862c4ce8bbe67d0c1a125427\clipboard.png)

**闭包: 内部函数引用外部函数的变量；**



**闭包**就是一个函数引用另外一个函数的变量，因为变量被引用着所以不会被回收，因此可以用来封装一个私有变量。这是优点也是缺点，不必要的闭包只会徒增内存消耗！另外使用闭包也要注意变量的值是否符合你的要求，因为他就像一个静态私有变量一样。闭包通常会跟很多东西混搭起来，接触多了才能加深理解，这里只是开个头说说基础性的东西。

js的每个函数都是一个个小黑屋，它可以获取外界信息，但是外界却无法直接看到里面的内容。将变量 n 放进小黑屋里，除了 inc 函数之外，没有其他办法能接触到变量 n，而且在函数 a 外定义同名的变量 n 也是互不影响的，这就是所谓的增强“封装性”。



// 闭包 function counter () {     let c = 0;     return function(){         return ++c     }; };  const c = counter() // 引用加1 ，保留下来；  console.log(c())   // 运行 function 函数；而不是couter   console.log(c()) console.log(c()) #------------------------------------------------------- 1 2 3  // 生成器版本： function *counter() {     let c = 0;     while (1)         yield ++c; }  const inc = counter() ; // 生成器对象； value:  1  , done:  2   console.log(inc.next()) console.log(inc.next().value) // console.log(inc.next().value) #---------------------------------------------------------------- { value: 1, done: false } 2 3 



#### 6.JS语法-特殊对象



![img](G:\rjdata\youdaoyun\syppp520@163.com\b2663dcbb972490485a841dcab976583\clipboard.png)

![img](G:\rjdata\youdaoyun\syppp520@163.com\b681e8639b6a422fbdc12037c320e951\clipboard.png)



#### 7.JS进阶

![img](G:\rjdata\youdaoyun\syppp520@163.com\8e3a1966d6f040b9880ad909f6961abe\clipboard.png)

##### 7.1 事件循环

![img](G:\rjdata\youdaoyun\syppp520@163.com\4b5d4f4e1e6c49b8a44c7bf238c1f4e1\clipboard.png)

参考：JS事件循环机制+实战+详解



JavaScript 语言是单线程的，单线程就意味着，所有任务需要排队，前一个任务结束，才会执行后一个任务。如果前一个任务耗时很长，后一个任务就不得不一直等着。

js 引擎执行异步代码而不用等待，是因为有任务队列和事件循环机制。

任务队列执行先进先出机制。

console.log(Date.now(), 'start') setTimeout(() => {     console.log(Date.now(), 'time') }, 100) for (var i = 0; i < 1000000000; i++) {     var a = i } console.log(Date.now(), 'end')  





**宏任务和微任务**

异步任务：

- 宏任务：script(整体代码)、setTimeout、setInterval
- 微任务：Promise、process.nextTick

宏任务和微任务是有优先级的。在一个事件循环中，优先执行宏任务，再执行微任务。因为把同步任务可以归到宏任务，script下整体代码就是宏任务。

事件循环机制:

1. 同步任务执行即宏任务执行，可以理解为同步宏任务。
2. 碰到宏任务，就把宏任务放到宏任务队列中，但是先不执行，需要执行完上一个宏任务里面的微任务才执行。
3. 碰到微任务，就把微任务放到微任务队列中。
4. 当宏任务执行完后，立即就会执行微任务队列。
5. 微任务队列执行完毕，如果还有宏任务，就继续执行。

##### 7.2 原型链

![img](G:\rjdata\youdaoyun\syppp520@163.com\80d0881c72ff49939011f243d95c2583\clipboard.png)



babel 到ES5转译后的代码；；



##### 7.3 异步编程

![img](G:\rjdata\youdaoyun\syppp520@163.com\6edb8c7092834f2491394ffb841b40ed\clipboard.png)





![img](G:\rjdata\youdaoyun\syppp520@163.com\887d3675369d40c6bda7c09096b9077a\clipboard.png)

##### 7.4 浏览器缓存

![img](G:\rjdata\youdaoyun\syppp520@163.com\730bb601c3574072b2db9933bb763383\clipboard.png)



##### 7.5 跨域



![img](G:\rjdata\youdaoyun\syppp520@163.com\7b0da267c9c24103b80e62ec7851688f\clipboard.png)

##### 7.6 Webpack打包

![img](G:\rjdata\youdaoyun\syppp520@163.com\373b5b42cd6348a388bc9e6a6f63df7a\clipboard.png)

babel 打包成固定的静态文件





### 04 三 05奇⻔遁甲——调用 JavaScript 执行代码【上下】_enc

![img](G:\rjdata\youdaoyun\syppp520@163.com\0fa74e36e26b4f16b1994a3d93ec76b3\clipboard.png)



#### 1. 为什么我们需要直接调用JS

1. 调用JS**

![img](G:\rjdata\youdaoyun\syppp520@163.com\4f81965779f64378acfe82f3422d6609\clipboard.png)

**简单的JS运行**

两种JS 常见代码的重写

对应的库  :  Base64-hashlib

![img](G:\rjdata\youdaoyun\syppp520@163.com\3d6ad3f093d54f73aa494f0e3e8bd95a\clipboard.png)

**复杂的JS运行**；

算法部分进行改变，代码量大，**连操作后产生的字符串 都看不出**，无法直接使用现成的库来进行操作了；



**2. 调用程序调用JS**

![img](G:\rjdata\youdaoyun\syppp520@163.com\a942d989cdb64ccd8d0656c77bd999d9\clipboard.png)



#### 2. 了解常见Python调用JS的库

**2.1 Python 调用JS;**



PyV8不推荐；存在内存泄露的问题；

![img](G:\rjdata\youdaoyun\syppp520@163.com\7e526ad816514bea8d27e518ab3c11f3\clipboard.png)

Js2Py

![img](G:\rjdata\youdaoyun\syppp520@163.com\3b3f406c4a7c426797966d209e748908\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\d719f44f7e20461894db4e6ce6d4be27\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\472278d352824304976d1702ef07b89e\clipboard.png)

**PyExecJS**

![img](G:\rjdata\youdaoyun\syppp520@163.com\49ceef63c126426dab252d954cc279ad\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\9609613cf01a49f18b7d607a36855183\clipboard.png)

**环境设置（V8）**

![img](G:\rjdata\youdaoyun\syppp520@163.com\261a848cad6a4e8e8db63ade7472eeea\clipboard.png)

**不是V8的设置**

![img](G:\rjdata\youdaoyun\syppp520@163.com\e40dd2f0456f4f66b974383515a40b82\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\85ff1d5e1d4b42ae8266beff957ec298\clipboard.png)

我们使用的JS的代码是非常多的

JS函数参数调用的方法；

![img](G:\rjdata\youdaoyun\syppp520@163.com\a9e748a613c7477d9748ae4837a3b22e\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\b9081bdaef634e7bbf61fbd2e9a2f58e\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\b9fb1006683941b29c110df33581c306\clipboard.png)

return **result  为一个object**；**在Python中建议转换为Json字符串**；



**PyExecJS存在的一些问题**

![img](G:\rjdata\youdaoyun\syppp520@163.com\8511978132c44728917b79621207eb82\clipboard.png)

**3. 其他使用Python调用JS的骚操作**

##### Selenium

**1. Selenium 执行JS，验证码，登录**

![img](G:\rjdata\youdaoyun\syppp520@163.com\6873f9c06e4d402ab0ceba4fca898db5\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\13dba40f69b6405785a067a32fb5917a\clipboard.png)

**base.js 文件的加载 生成的页面**

![img](G:\rjdata\youdaoyun\syppp520@163.com\0ebeda7349d24a19adc1f618c336248f\clipboard.png)

base.JS 文件

![img](G:\rjdata\youdaoyun\syppp520@163.com\9980b88076e8440daa278ae2a028e3c2\clipboard.png)



**def get_text() 里面的JS代码要 写两个{{ }}**

![img](G:\rjdata\youdaoyun\syppp520@163.com\286d1b3e9b0349aa8735124159852c49\clipboard.png)

##### **Pyppeteer**

**Pyppeteer：比selenium更高效的爬虫界的新神器**

Puppeteer是nodejs版本的；

一是：因为有些接口带着加密参数，比如 token、sign 等等，模拟难度较大；

二是：抓包的方式只适合量小的情况。如果有一百、一千个，甚至五千、一万个网站要处理时，该如何处理？还一个一个分析数据流？一个一个去抓包吗？



基于以上的两个严重的缺点，那有没有一种简单粗暴的方法，既不需要分析数据流，不需要抓包，又适合大批量的网站采集呢？这时 **Puppeteer、Pyppeteer、Selenium、Splash** 等自动化框架出现了



![img](G:\rjdata\youdaoyun\syppp520@163.com\97d8c552ac7a444d9c091f759cf876e0\clipboard.png)

使用这些**框架获取HTML源码**，这样我们  爬取到的源代码就是JavaScript 渲染以后的真正的网页代码，数据自然就好提取了。同时，也就绕过分析 Ajax 和一些 JavaScript 逻辑的过程。这种方式就做到了可见即可爬，难度也不大，同时适合大批量的采集。由于是模拟浏览器，一些法律方面的问题可以绕过。

**Selenium缺点：**速度太慢、对版本配置要求严苛,最麻烦是经常要更新对应的驱动；有点反爬的网站都会对selenium和webdriver进行识别



由于Selenium具有这些严重的缺点。pyperteer成为了爬虫界的又一新星。相比于selenium具有异步加载、速度快、具备有界面/无界面模式、伪装性更强不易被识别为机器人，同时可以伪装手机平板等终端；虽然支持的浏览器比较单一，但在安装配置的便利性和运行效率方面都要远胜selenium;



![img](G:\rjdata\youdaoyun\syppp520@163.com\bf812aace77046c382982d63ce396248\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\4af13e71f4be416dbb399b1f5270c059\clipboard.png)

开启server.py 运行demo.py ;

![img](G:\rjdata\youdaoyun\syppp520@163.com\6d0d6611e0834063b7d9e0135c11fe7e\clipboard.png)

失去了内存缓存、JS解释器本身的一个优化；**有没有性能更高的方式**？

就是使用NodeJS 执行JS;然后开放一个服务

#### 3. 了解性能更高的调用方式

##### 1. 用Nodejs调用JS

1.RPC

![img](G:\rjdata\youdaoyun\syppp520@163.com\85103f938f3e47278bbbe0c2504f667c\clipboard.png)

2.HTTP API

![img](G:\rjdata\youdaoyun\syppp520@163.com\56b307c84a2f4493b28f8adb05807aa8\clipboard.png)

##### **Express 框架**

$ cnpm install express --save

**创建HTTP服务，**

![img](G:\rjdata\youdaoyun\syppp520@163.com\16d4793975db41e4873696f2e37ea25d\clipboard.png)



![img](G:\rjdata\youdaoyun\syppp520@163.com\04c07e3ed78f4493919c6da0626c305a\clipboard.png)

**参考：**Nodejs Express框架入门    中间件 body-parser 原理分析（手写bodyParse)）

![img](https://mmbiz.qpic.cn/mmbiz_png/FaeDdIfeuq7CWon6mjDv3kNHZTxN2XAI3Me3doLCt1eXHYEIJmQY3etlXSVZ0uibG9mRSIYfa7N8wGicTaBOLrqQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

###### **实例1**

```

// service.js
const express = require("express");
const bodyParser = require("body-parser");

function sum(a,b) {
    return a + b;
  }

//创建服务
const app = express();

// 使用body-parser中间件；
app.use(bodyParser.urlencoded({ extended: true}))
app.use(bodyParser.json());

// 创建路由
app.post("/get_num", function(req,res){
    console.log(req.body);
    let result = req.body
    console.log("result",result)
    let a = parseInt(result.a)
    let b = parseInt(result.b)
    result = sum(a, b)
    res.send(result.toString());

})

app.listen(3000, function(){
    console.log("server start 3000")
})
# client.py
import requests

url = "http://127.0.0.1:3000/get_num"
data = {
    "a":1, "b":2
}

req = requests.post(url, data)
print(req.text)

# ------------
3
```

###### 实例2

![1602420339868](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602420339868.png)

**要执行的crypto.js 文件（JS逆向代码文件）**

![1602421496187](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602421496187.png)

![1602421642900](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602421642900.png)

##### 2. 使用Nodejs存在的问题

![1602422219010](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602422219010.png)

JS库jsdom仍有很多的bug

###### 实例1 window

![1602422154899](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602422154899.png)

#### 4. 知道什么场景下使用什么方式调用





### 06 四 蓄势待发——浏览器开发者⼯具的介绍和使⽤技巧【第一节】

![1602468307218](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602468307218.png)

#### 1. 浏览器开发者工具的介绍

![1602468466054](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602468466054.png)



![1602468505633](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602468505633.png)

![1602468521468](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602468521468.png)

![1602468582170](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602468582170.png)

#### 1.2 浏览器开发者功能简介

source面板是我们使用最多的面板

![1602469178309](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602469178309.png)



![1602469210062](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602469210062.png)



### 07 四 蓄势待发——浏览器开发者⼯具的介绍和使⽤技巧【第二节】

#### 1. Network面板的介绍与使用

##### 1.1 Network面板介绍

![1602469844653](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602469844653.png)

![1602469890828](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602469890828.png)

![1602470497732](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602470497732.png)

domain:*.nightteam.cn

status-code:200

![1602471793787](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602471793787.png)

![1602471839472](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602471839472.png)



##### 1.2 异步请求重发

![1602473023921](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602473023921.png)

##### 1.3 如何5s生成爬虫代码

![1602473076978](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602473076978.png)

**copy as cURL(bash)格式**：postman import

![1602472746452](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602472746452.png)



![1602473049666](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602473049666.png)

**shift 悬停在 一个请求上（蓝色），会显示 上一个依赖的请求（绿色）**

![1602472932106](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602472932106.png)





#### 





### 08 四 蓄势待发——浏览器开发者⼯具Source面板的介绍和使⽤技巧

#### 3.Source面板的介绍与使用

![1602494529770](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602494529770.png)

![1602494551489](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602494551489.png)



![1602494571209](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602494571209.png)

![1602494598233](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602494598233.png)



请求保存到本地

![1602491054278](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602491054278.png)

![1602491961481](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602491961481.png)

条件断点；；

**XHR断点**：基于XHR生命周期发生改变的时候；**XHR的URL与设置匹配的字符串相匹配**的时候；





**元素断点**：

![1602492334483](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602492334483.png)

**事件监听断点**：

![1602492454108](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602492454108.png)







###### 实例1：

password: d3e62030b7bf16b79ba4424a7a544fd5

全局搜索 password

![1602492878366](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602492878366.png)

![1602493086938](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602493086938.png)



**成功paused in debug, 悬停鼠标到reset上**（或者**点击下标按钮**），可以看到函数信息![1602493288406](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602493288406.png)

点击 上标；跳出当前函数，在下一个函数中断上；

![1602493523258](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602493523258.png)



###### call stack

从断点的函数起，逐级去追寻调用到他的函数名称（反序排列）；

![1602494328107](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602494328107.png)



###### Scope作用域：

当前断点所在的作用域内容

![1602494421308](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602494421308.png)

### 09 四 蓄势待发——浏览器开发者⼯具Console面板的介绍和使⽤技巧

#### Console面板的介绍与使用

#### 1. Console面板的基本操作

![1602506226497](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602506226497.png)







#### 2. Console的一些骚操作；

![1602507378559](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602507378559.png)

console.table 和 Copy(data)

**$ 最后一次执行**的结果

$ 结合Xpath使用

![1602507445872](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602507445872.png)

##### $ 结合Xpath使用

$('.subject')**

**$$('.subject')** 返回一个数组

$x('//*[@id="body"]/div/div/div[1]/div[3]/div[2]/ul/li[3]/div/div[1]/a[1]')

![1602507959726](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602507959726.png)





### 10 四 蓄势待发——浏览器开发者⼯具的介绍和使⽤总结



![1602509536854](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602509536854.png)

**重点** : Source面板的断点代码调试；



### 11 五 磨⼑霍霍——常用⼯具的介绍和使⽤技巧【Charles】

**APP开发或者JS逆向**，分析网络请求的需求；



**参考:**

**测试必备工具之最强抓包神器 Charles，你会了么？**

**接口测试之——Charles抓包及常见问题解决**

#### 1. Charles

Charles是一款的抓包修改工具,其实也是一款代理服务器，通过成为电脑或者浏览器的代理，然后截取请求和请求结果达到分析抓包的目的

![1602549906702](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602549906702.png)







没有安装证书，https都显示是unknown, http都显示正常



##### **安装证书**

但是可以在 Charles 中，通过一些简单的配置，使其安装 Charles 的 CA 证书。

具体步骤如下：

1. 在 Mac 上安装 CA 证书。通过顶部菜单选择：Help → SSL Proxying → Install Charles Root Certificate，来安装 CA 证书。
2. iPhone 中，通过访问 http://charesproxy.com/getssl来下载安装 Charlse 的 CA 证书。
3. 在需要截取Https的请求上，选择 Enable SSL Proxying。

##### 监听端口*

![1602552287861](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602552287861.png)

![img](https://upload-images.jianshu.io/upload_images/6900654-897bc55613f5ea8e.png?imageMogr2/auto-orient/strip|imageView2/2/w/438/format/webp)



抓包 http://httpbin.org/get

![1602552846636](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602552846636.png)

![img](https://upload-images.jianshu.io/upload_images/6900654-bd0992d1c9bcdbe4.png?imageMogr2/auto-orient/strip|imageView2/2/w/700/format/webp)



可以非常清楚的看到response,和request

![img](https://upload-images.jianshu.io/upload_images/6900654-c19b2af8880dbb60.png?imageMogr2/auto-orient/strip|imageView2/2/w/700/format/webp)

**focus 请求**：星标

#### 2.Charles功能介绍

##### 重发请求

![1602553294123](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602553294123.png)

##### 修改请求

可以修改UA,  execute执行；

![1602553315532](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602553315532.png)

##### 设置断点

通过Proxy-Breakpoint settings...中手动新建/启用某个断点;

要求勾选enable breakpoints

之后当下次再有该请求时,会自动进入断点模式;

一个完整请求会进入断点模式2次:

request的发出之前;

收到服务器的response但尚未返回给客户端的时候;

断点request的时候,可以修改request信息,不过我们程序都有对请求header做校验和处理,修改参数后一般就直接报错了,所以这里看看response就好,反正操作类似:

![img](https://upload-images.jianshu.io/upload_images/6900654-6a79140f3aeb4322.png?imageMogr2/auto-orient/strip|imageView2/2/w/655/format/webp)

断点网址添加

![1602553607428](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602553607428.png)

![1602554641164](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602554641164.png)

修改get/headers, 可以看到response只包含headers;

![1602555378890](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602555378890.png)

修改UA=Charles,执行；



##### 模拟网速

这里设置完成后通过Proxy-Start Throttling(Ctrl+T)或者常用工具栏按钮来启用或停止;

![img](https://upload-images.jianshu.io/upload_images/947286-0be2bf8f0ddb2a3d?imageMogr2/auto-orient/strip|imageView2/2/w/532/format/webp)







##### 反向代理

将一个host转发到另外一个host

![1602558119824](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602558119824.png)

httpbin请求转发到：localhost:8080

![1602558211784](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602558211784.png)

代理方式2

![1602558375631](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602558375631.png)



##### 请求URL本地替换

反向代理-

http://quotes.toscrape.com/

修改html文件 添加map local

![1602559269015](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602559269015.png)





### 12 五 磨⼑霍霍——EditThisCookie的介绍和使⽤技巧

#### 1. EditThisCookie

cookie管理器。您可以添加，删除，编辑，搜索，锁定和屏蔽cookies

**安装**: 访问 chrome://extensions

![1602559750312](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602559750312.png)

#### 2.EditThisCookie功能

对于hostonl的value值修改不方便，所以使用EditThisCookie

![1602560181885](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602560181885.png)

![1602560280080](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602560280080.png)

可以设置**导出cookies的格式**为： Json ;   Semicolon separated Cookie File 与网页格式一致；



###### 练习1：cookies清楚和导入

EditThisCookie  复制，清除，并导入





### 13 五 磨⼑霍霍——Toggle JavaScript 的介绍和使⽤技巧

![1602575472316](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602575472316.png)

https://chrome.google.com/webstore/detail/toggle-javascript/cidlcjdalomndpeagkjpnefhljffbnlo?hl=en

#### 1. Toggle基本使用

Toggle JS 禁用JS执行的功能





### 14 五 磨⼑霍霍——Tampermonkey 的介绍和使⽤技巧

#### 1. Tampermonkey油猴插件

![1602576017697](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602576017697.png)



![1602577630863](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602577630863.png)



**文档**

https://www.tampermonkey.net/faq.php?version=4.11&ext=dhdg&updated=true&show=dhdg



**脚本执行**；

![1602577892953](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602577892953.png)





正常执行的脚本会显示在test， 在console中会显示 hello world!

![1602578424279](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602578424279.png)



**脚本调试** 禁用后 就不会自动进入断点模式：debugger;

![1602578665915](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602578665915.png)



#### 2. Tampermonkey 在JS逆向中的应用

![1602578744128](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602578744128.png)



##### Hook技术原理：

Hook技术在原来JS代码中替换函数， 使得JS代码运行的效果没有改变的情况下； 自定义代码的功能；

是通过修改程序代码或数据，达到改变程序逻辑的目的 



##### hook注入工具

###### Tampermonkey



```
// ==UserScript==
// @name         eval
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  try to take over the world!
// @author       You
// @match        http://*/*
// @grant        none
// @run-at document-start
// ==/UserScript==
```

**run-at  document-start** 加载前注入





##### Tampermonkey + Hook案例

![1602579908968](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602579908968.png)

```

window.btoa
ƒ btoa() { [native code] }
btoa('123')
"MTIz"
btoa('123456789')
"MTIzNDU2Nzg5"
```



**btoa 方法：**hook(window, 'btoa')

**atob 方法：**hook(Json, 'stringify')

**log方法**：    hook(console, 'log')

![1602580726903](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602580726903.png)





###### **实例1：**login1

login1: 模拟登录网站，登陆时 用户名和密码经过加密，适合 JS逆向分析；

![1602589187519](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602589187519.png)



**解决方法**1：用Ajax断点把它实现出来；

XHR/fetch Breakpoints 中 加入网址 https://login1.scrape.center/ 断点； 提交下 就会进入断点模式；

![1602589357125](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602589357125.png)

**send 上 shift 就可以看到加密后的token**;; 右边有**Promise.then 标志**，说明调用了AJax请求

![1602589467905](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602589467905.png)



第一次断点停在apply函数上，登录一下进入断点；

![1602589838145](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602589838145.png)



第二次断点停在 **onSubmit** 上面

![1602589926257](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602589926257.png)

真正的加密入口地址：

![1602590184095](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602590184095.png)



**解决方法2：Hook技术**

hook base64加密的token 就可以实现真正的Base64编码过程位置的捕捉；

token: "eyJ1c2VybmFtZSI6ImFkbWluIiwicGFzc3dvcmQiOiJhZG1pbiJ9" 像base64编码后的代码；

```
// btoa方法；
window.btoa
ƒ btoa() { [native code] }
btoa('123')
"MTIz"
btoa('123456789')
"MTIzNDU2Nzg5"

```

![1602592548663](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602592548663.png)



hook技术就成功的找到了一个Base64编码的入口；

![1602592115766](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602592115766.png)



![1602592382335](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602592382335.png)

![1602580726903](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602580726903.png)





### 15 六 初窥⻔径——阻挠爬⾍⼯程师的⽆限 debugger【上】_enc



#### 1.什么情况下会遇到debugger

#### 2.为什么反爬虫会用到debugger

#### 3.debugger反爬虫的又是在哪里



![1602637584211](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602637584211.png)

#### 4. 无限debugger的主要作用

![1602637638584](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602637638584.png)



#### 5. 无限debugger的实现

![1602637679554](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602637679554.png)









#### 6. 无限debugger的解决方案

![1602639752158](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602639752158.png)





**禁用某处断点   ： never pause here**

![1602638843423](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602638843423.png)





**添加 条件断点：i > 5 ;**    **false永远不执行**；

![1602639099046](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602639099046.png)



**中间人工具替换特征字符串**；

将debugger替换掉（字符串）；





**reres替换本地修改过的文件**；

浏览器拓展程序的原理: 当插件监控到浏览器向服务器请求JS文件的时候, 就会直接把本地你修改过的JS文件使用



**重写关键函数**

感觉也是比较稳妥的方法

![1602639769687](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602639769687.png)

在2222处重写start_debugger函数；





###### 实例2：无限 debugger 

js文件生成一个cookie交给后端校验；出发无限debugger

![1602640156544](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602640156544.png)



将_0x4db1c 设置为空，清楚debugger就可以分析代码；

或者: **(function(){}).constructor === Function**   、 false 构造器至空，（相等的才行）

![1602640400129](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602640400129.png)

setcookie 是有虚拟机中 reload(arg2) 



###### **小技巧：**怎么去分析JS生成cookie的过程；

cookies清除后，刷新页面，重新访问；加载html 1s的同时ESC，就可以把当前的请求取消；







###### 案例3： 一打开就触发了debbuger

![1602725483979](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602725483979.png)



将debugger函数滞空，重新打开F12，再次滞空

![1602725964280](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602725964280.png)

可以看到html页面也已经正常了![1602726224970](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602726224970.png)



###### 案例4：构造一个debugger函数一直死循环执行

![1602726363121](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602726363121.png)



**函数 eval**； 就是这个函数的内容（str）

![1602726574426](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602726574426.png)



重写eval 

![1602726809606](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602726809606.png)

**在他执行之前setInterval 或 debugger打断点**；

![1602727621063](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602727621063.png)



```
// eval
window.__cr_eval = window.eval
var myeval = function(src){
    console.log("==== eval begin：length =" + src.length + ",caller=" + (myeval.caller && myeval.caller.name) + "====")
    console.log(">>>> eval injected：" + document.location + "<<<<")
    console.log(src);
    console.log("====eval end====")
    return window.__cr_eval(src)
}

//
// var _myeval = myeval.bind(null)
_myeval.toString = window.__cr_eval.toString
Object.defineProperty(window, 'eval', {value:_myeval})   //执行 eval 就会执行 修改过的 eval

```



![1602727819942](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602727819942.png)



#### 总结

![1602727922383](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602727922383.png)





### 17 七 ⽕眼⾦睛——定位加密参数对应代码位置的⽅法_enc



#### 1. 为什么要快速定位

js生成cookie的地方；

#### 2. 快速定位的优势（重点）

hook.tostring();

hook常见 的JAVA层加密算法，得到密钥；

![1602728308718](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602728308718.png)



##### 2.1 快速定位之搜索

![1602728403901](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602728403901.png)



filder

###### 文本搜索

只能搜索html的文本内容；

![1602728573871](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602728573871.png)

###### 全局搜索

可以搜索JS文件中的内容；

![1602728735997](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602728735997.png)



##### 2.2 快速定位之断点

![1602729642517](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602729642517.png)



![1602729175295](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602729175295.png)

重写函数；重新打开F12



发现arg加密参数；

![1602729265464](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602729265464.png)



对包含arg的URL打断点；

![1602729306893](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602729306893.png)



**分析核心加密代码**，一般都要调用2-3个调用栈；

![1602729413286](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602729413286.png)

###### Dom断点：

页面元素的断点；

![1602729768149](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602729768149.png)

子树、属性、节点移除；当初发这三个事件的时候，就会断下来



![1602729870173](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602729870173.png)

![1602729922118](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602729922118.png)

**节点移除**

![1602729990101](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602729990101.png)



###### Event断点（按钮）

左上角箭头 标记断点；

![1602730226557](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602730226557.png)

##### 2.3 快速定位之hook的断点类型

![1602730410084](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602730410084.png)



JS场景：md5方法的加密参数:

![1602730441220](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602730441220.png)



**js cookie**

![1602731042555](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602731042555.png)



![1602731121115](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602731121115.png)



**window.attr**

![1602731242123](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602731242123.png)

![1602731498219](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602731498219.png)



**eval/function**

![1602731761717](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602731761717.png)



**websocket**

![1602731913921](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602731913921.png)





##### 2.4 快速定位之基本分析方法

![1602732009323](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602732009323.png)

###### 1. 事件监听器



###### 2.Network type initattor

XHR 来源js

![1602732239362](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602732239362.png)

###### **3. 打印xml请求**



![1602732420668](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602732420668.png)



总结

**1. 事件监听器对 script打断点**：

![1602733030554](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602733030554.png)

###### 案例5：



meta  

js读取content 进行解析：对大量window进行赋值的；；

eval 代码中 有window的属性 初始化





![1602734180233](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602734180233.png)







### 18 八 拨开云雾——代码混淆的原理【上】

![1602750188973](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602750188973.png)





#### 1. 为什么要进行JS加密或者混淆

![1602750207167](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602750207167.png)



#### 2. JS加代码加密的实现

![1602750271677](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602750271677.png)



![1602750438780](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602750438780.png)



###### eval 

将JS代码加密为eval方法的字符串参数；；

![1602750621089](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602750621089.png)





###### Emscriptten

将C/C++代码编译为JS



![1602750657598](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602750657598.png)



###### WebAssembly

![1602750788470](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602750788470.png)





#### 

![1602751154038](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602751154038.png)



**字符串加密**MD5/base64/等；

**属性加密** : 把Key-value的一些映射关系进行混淆掉；

**控制流平台化**： 执行逻辑混淆；

**僵尸代码注入**：不可能执行的代码；；

**代码压缩：**

反调试： 基于浏览器的特性加（debugger）

多态变异：一旦调用就会编程和以前完全不一样的代码；代码形式变化，功能不变；

锁定域名： 有检测：特定域名下运行代码；

反格式化:  有特定的机制，代码无法运行；

特殊编码: JS代码编码成 难读的代码；



![1602752986885](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602752986885.png)



**javascript-obfuscator**：重点；

![1602753129092](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602753129092.png)



#### 3. 代码混淆技术实现

![1602754703812](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602754703812.png)



###### **1. javascript-obfuscator**

![1602754752875](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602754752875.png)

**混淆后的代码**

![1602754848001](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602754848001.png)



![1602754913201](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602754913201.png)



###### 2.变量名混淆

![1602754963969](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602754963969.png)



###### 3.字符串混淆

字符串填成一个数组的形式；

![1602755101906](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602755101906.png)



![1602755221314](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602755221314.png)



###### 4.反格式化

自我保护

![1602755239202](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602755239202.png)



###### 5.控制流平坦化

逻辑会变得非常复杂；

controlFlowFlattening: true  //打开控制流平坦化

![1602755326290](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602755326290.png)





![1602755431721](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602755431721.png)



###### 6.僵尸代码的注入

![1602755481807](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602755481807.png)

###### 7.属性加密：对象Key-Value替换

属性加密** :

![1602755492547](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602755492547.png)



###### **8.禁用控制台输出**

增大调试难度

![1602756525213](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602756525213.png)



![1602756603837](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602756603837.png)



###### 9.域名锁定

![1602756660677](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602756660677.png)



###### 10.特殊加密：

###### JSFuck

![1602756696413](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602756696413.png)



###### **JJEncode**

![1602756756165](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602756756165.png)



### 20 九 ⼀击即中——处理常见代码混淆加密分析流程【1】

#### 1. 加密分析流程

![1602811021669](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602811021669.png)

### 21 九 ⼀击即中——处理常见代码混淆操作的⽅法【2】



#### 样例1. 混淆JS代码为 网络表情编码的处理

查看混淆加密文件的源JS文件；

![1602811342924](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602811342924.png)





![1602811368290](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602811368290.png)

**搜索参数**：打开上一个stack, 添加index断点（index.html URL的部分字段） ；

![1602811613226](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602811613226.png)

刷新页面，成功断上；

![1602811469243](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602811469243.png)



找到：未加密的混淆代码；

![1602811718619](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602811718619.png)



复制一个新的加密代码到console 控制台中；源码没有报错，回车 undefined ；

![1602811806964](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602811806964.png)



###### **方法1：**删除最后一个表情（'_'），回车输出源码

![1602811977395](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602811977395.png)



###### 方法2：删除最后一个表情（'_'）,加上.toString()  ; 字符串输出

![1602812055580](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602812055580.png)





![1602812179347](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602812179347.png)





#### 样例2. 混淆器和混淆网站生成的代码

通过混淆器和混淆网站生成的代码，一般可以在控制台console直接执行；

![1602815129312](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602815129312.png)

**控制台没有报错：**![1602815589850](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602815589850.png)

###### **方法1：**在尾部 加上.toString();

![1602815655865](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602815655865.png)





###### 代码混淆的原理

下面的两行function代码是等价的；

![1602815837760](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602815837760.png)

![1602815911555](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602815911555.png)

![1602816023618](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602816023618.png)





#### 样例3. 6种字符([,],(,),!,+)代码的混淆



![1602818494474](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602818494474.png)



代码混淆的位置；

![1602817549000](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602817549000.png)

##### 报错

console运行一下，根据报错**提示找到未加密的代码**  VM106.js;

![1602817613538](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602817613538.png)



得到未加密的代码

![1602817726456](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602817726456.png)



##### 不报错：

###### 方法1: 删除最后一个括号()

回车输出不报错；删除最后一个括号（），输出代码；

![1602817807401](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602817807401.png)



###### 方法2：最后添加 .toString()



##### 特殊案例： 尾巴没有括号

![1602818096944](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602818096944.png)



https://beautifier.io/   上粘贴 代码 进行格式化；

**将最后一个括号内的代码** 复制出来在控制台console 执行；；

![1602818182865](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602818182865.png)

**将最后一个括号前面的代码**单独复制出来，在console执行

![1602818234920](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602818234920.png)

结果为eval代码；；

![1602818297679](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602818297679.png)

![1602818406408](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602818406408.png)





#### 样例4.  eval-特征字符为 function(p,a,c,k,e,r)的代码

![1602821135720](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602821135720.png)





![1602818695214](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602818695214.png)

先抓包分析代码，在网页上没有看到网页显示的文字内容；

![1602818614432](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602818614432.png)



网页elements 内容都是在content div下的；

应该是有一段代码操纵了html，然后将内容插入，但是我们在请求response页面并没有看到相关内容；

![1602818720552](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602818720552.png)



查看网页源代码：可以看到有一长串JS代码（不是加密，是编码）；

![1602819642080](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602819642080.png)



复制这段代码，到编辑器中新建.js文件，为压缩后的JS代码，**格式化一下**

![1602819845159](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602819845159.png)

**看到eval**，eval中接受的参数是包含有效JS代码的字符串，并执行的； 它的参数是必须包含有效JS代码的字符串；

![1602820158085](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602820158085.png)

将**eval（）内代码在console.log()中** 执行，就可以得到解密后的代码了；

![1602820916465](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602820916465.png)

复制一下，新建JS文件，在格式化一下，就得到解密后代码了



![1602821014305](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602821014305.png)



![1602821029992](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602821029992.png)







#### 样例5.  混淆严重的base64/RC4 加密



![1602988966963](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602988966963.png)

所有的内容都在div class=content 下；这些html（content）是在哪里进行了操作；

![1602984714563](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602984714563.png)

**禁用JS**，当前页面的内容就没有加载出来；

![1602985317400](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602985317400.png)

当前页面有大段JS，JS代码的混淆度是比较高的；

![1602985477089](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602985477089.png)

**259-263进行了方法的调用**；

![1602985701367](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602985701367.png)

console面板中输出一段代码有那些字符串内容；

![1602985835408](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602985835408.png)

这**长串代码**其余的部分分别 **输出 html和content **部分；![1602985919011](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602985919011.png)

这是**一个标准的JQuery插入html的代码**了；

![1602986070678](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602986070678.png)





将**Script以内部分的 代码粘贴到编辑器中**，

![1602986237439](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602986237439.png)



知道了哪一段代码可以输出**正文内容**，所以就没必要用他来混淆代码来 干扰分析；

将**断点部分的内容（输出html/content）替换为console.log()**；

![1602986558185](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602986558185.png)





![1602986459008](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602986459008.png)



复制可以输出正文部分的代码；粘贴到文件

![1602986969525](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602986969525.png)



![1602988055205](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602988055205.png)

报错**，CrytoJS 这个方法是没有定义的；通常将这个安放方法定义为空；**；

![1602988419174](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602988419174.png)



**CrytoJS 定义为空**，还是会报错；

![1602988522300](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602988522300.png)

**解决方法**:  引入nodejs加密库：crypto-js

 ![1602988588844](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602988588844.png)



**输出正确内容**； 

**atob方法**就是Base64的解密方法；

![1602988674700](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602988674700.png)





![1602988961548](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602988961548.png)



##### 练习：解密案例



![1602989451212](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602989451212.png)



#### 总结：

##### 0. 加密参数的分析流程

![1602989613221](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602989613221.png)



##### 1. 样例



![1602989800155](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602989800155.png)







![1602990072866](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1602990072866.png)









### 27 十 知⼰知彼——掌握常⻅的编码和加密

参考：深入理解字符编码（ASCII、Unicode、UTF-8、UTF-16、UTF-32）

#### 1. Ascii

![img](https://mmbiz.qpic.cn/mmbiz_jpg/0ib44Sib5AL7MSqKlTbcBFC9leEu1vg8bgAFiak8yohDbJRDBB7m5bpiaictZI2kEpP1ibjuw3icKD17BiaAsjQCudiblDw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



![1603006335149](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603006335149.png)



![1603006601070](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603006601070.png)



![1603006736199](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603006736199.png)

![](https://upload-images.jianshu.io/upload_images/7058492-fdd019bfd0f687d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

##### 1. 编码与解码（UTF-8、ASCll码）

```
在互联网中文件是以utf-8格式进行传递，所有在传输文件（字符串）前后需要进行编码（encode）和解码（decode）

1、编码
        国标系列：（常用于Windows）
                GB18030（2字节或4字节编码，共27533个）
                    GBK（2字节编码，共21003个）
                        GB2312（2字节编码，共6763个汉字）       

        国际标准：（常用语Linux /Mac OS X / IOS /Android）
                UNICODE16/UNICODE32   <<<---->>>      UTF-8（中文 大多数字都是三个 字节，有一些符号是 四字节）
                注：UTF-8（8-bit Unicode  Transformation  Format）
2、编码注释
  在python 源文件第一行或第二行写入如下内容是告诉解释执行器此文件的编码类型是什么
  如
# -*- coding: gbk -*-
# 设置源文件编码格式为gbk

  或
# -*- coding: utf-8 -*-
# 设置源文件编码格式为utf-8

print('中'.encode())            |  b'\xe4\xb8\xad'
#(b'\xe4\xb8\xad').decode()=bytes((0xe4,0xb8,0xad)).decode()
print((b'\xe4\xb8\xad').decode())      |  中
bytes((0xe4,0xb8,0xad)).decode()    |  '中'

2. UTF-8 的编码方式比较友好
```



#### 2. Base64

![1603007112917](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603007112917.png)

![1603007196132](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603007196132.png)



**Base64编码本质**上是一种将二进制数据转成文本数据的方案。对于非二进制数据，是先将其转换成二进制形式，然后每连续6比特（2的6次方=64）计算其十进制值，根据该值在上面的索引表中找到对应的字符，最终得到一个文本字符串。

![1603007311029](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603007311029.png)

自定义码表；

![1603007416877](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603007416877.png)



#### 3.信息指纹md5

![1603007693227](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603007693227.png)





![1603007788230](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603007788230.png)

**一致性校验**，防止里面有有害程序；

防止明文存储；





![1603008051876](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603008051876.png)



**查码表**；

![1603008151380](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603008151380.png)

#### 4. AES高级加密

![1603008277961](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603008277961.png)





![1603008308659](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603008308659.png)

##### AES加密原理



![1603008366341](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603008366341.png)





![1603008493771](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603008493771.png)





![1603008583179](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603008583179.png)





### 28 十二 ⼀叶障⽬——服务端返回的神秘字符串_enc



![1603008856361](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603008856361.png)

#### 1.了解两种神秘字符串的产生过程

神秘的JS数据；

![1603008946051](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603008946051.png)

**解决方案1：**常规加密

![1603008969640](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603008969640.png)

**解决方案2：** 看不懂的字符串；

![1603009025984](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603009025984.png)

![1603009040272](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603009040272.png)









##### 案例：

清除网络cookies;

![1603009162017](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603009162017.png)





**响应结果为加密字符串**；复制出来；

![1603009617562](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603009617562.png)





![1603009685960](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603009685960.png)



原始JS代码； atob方法；查看cookie

![1603009703265](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603009703265.png)



![1603009827463](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603009827463.png)

构建解密代码：

报错document没有定义（其实已经定义了），**去掉定义的var**;



![1603009850602](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603009850602.png)



![1603009942528](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603009942528.png)





AES解密

先清除cookies，F5刷新；

![1603010269337](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603010269337.png)

在可以的地方打一个断点；

![1603010356906](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603010356906.png)





![1603010424703](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603010424703.png)



![1603010465208](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603010465208.png)





##### 脚本解决方法：

![1603010563840](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603010563840.png)

重新加载我们的页面，就打印出了我们加密的具体方法；

![1603010613777](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603010613777.png)

![1603010662511](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603010662511.png)



##### Json.parse法：

清除断点，重新加载页面；

![1603010708583](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603010708583.png)



加debbuger,打断点

![1603010780005](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603010780005.png)

![1603010804320](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603010804320.png)

最终

![1603010849103](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603010849103.png)







#### 2.掌握这两种神秘字符串的破解方式









### 29 十三 螳臂当⻋——解密！AES 并不是每次都奏效【第一节】_enc

![1603073137354](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603073137354.png)







#### 1. 对称加密（AES）

![1603071211800](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603071211800.png)

速度快，安全性低





#### 2.非对称加密

![1603071300081](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603071300081.png)

#### 3.对称加密和非对称加密的区别

![1603071510629](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603071510629.png)

##### 解决方案：

用非对称加密 加密对称加密的密钥；



#### 4. AES加密是什么

![1603071562917](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603071562917.png)







![1603071604382](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603071604382.png)





![1603071617813](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603071617813.png)

![1603071652343](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603071652343.png)



![1603071706150](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603071706150.png)

##### 加密填充前三种：

PKCS7Padding ：明文最后一位为0的时候，解密会经常出现错误；

ZeroPadding : 推荐使用

不足**6位 和 7位**；

![1603071981156](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603071981156.png)





![1603072022629](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603072022629.png)

![1603073031532](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603073031532.png)

![1603073059286](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603073059286.png)



#### 5. AES加密总结

![1603073119194](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603073119194.png)





#### 6. AES加密的代码实现

![1603073159683](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603073159683.png)



##### CBC

![1603073234322](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603073234322.png)



##### ECB

**特征：**没有IV

![1603073357355](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603073357355.png)

![1603073377197](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603073377197.png)







### 30 十三 螳臂当⻋——解密！AES 并不是每次都奏效【实战】

#### 案例：AES加密解析



打开控制台；

![1603074496943](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603074496943.png)



将debbuger函数滞空；

![1603074548000](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603074548000.png)



点击获取彩蛋 按钮，获取到一个请求；

![1603074649001](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603074649001.png)





![1603074673432](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603074673432.png)

arg；

![1603074700850](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603074700850.png)

arg为一个时间戳；

![1603074761826](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603074761826.png)



![1603074838313](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603074838313.png)

打上断点，重新获取一次；



![1603074912359](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603074912359.png)

![1603074932793](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603074932793.png)

没有IV,猜测其为ECB加密；



![1603075085974](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603075085974.png)

查看**密钥：**

![1603075195566](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603075195566.png)

![1603076406964](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603076406964.png)

未加密的明文；

拿到**2个参数，只剩下最后一个参数**padding；

![1603076437916](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603076437916.png)



用三种填充方式分别进行测试：Pkcs7/zeropadding/nopadding,得到加密结果



![1603076618525](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603076618525.png)

执行一下，得到原始的结果（与PKcs7加密结果一致）

![1603076673653](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603076673653.png)









### 31 十三 螳臂当⻋——解密！AES 并不是每次都奏效【总结】

![1603076846636](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603076846636.png)

#### **重点：**

AES加密了流程，工作模式，**padding的常见三种方式**：**Pkcs7/zeropadding/nopadding**





![1603077354795](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603077354795.png)



AES加密库**： crypto-js

![1603077171459](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603077171459.png)



http://tool.chacuo.net/cryptaes

![1603077265518](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603077265518.png)





### 32 十四 插翅难逃——纵然 CSS 加身，也难逃命运的安排

#### CSS反爬；

利用CSS增大反爬的难度；

![1603077497833](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603077497833.png)





#### 1.CSS反爬基础

![1603077551697](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603077551697.png)





![1603077618962](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603077618962.png)

![1603077636932](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603077636932.png)

**Dom**:  浏览器将html解析成一个树状结构；

**CSSOM**： CSS Object Mode 也是将CS解析成一个树状的结构；

**Render Tree**:  将DOM 与CSSOM组合起来生成一个新的数据结构—渲染树：



##### CSS语法

![1603077914428](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603077914428.png)



##### CSS布局

![1603078162546](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603078162546.png)

###### CSS布局：浮动

![1603078197201](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603078197201.png)



###### CSS布局：定位

![1603078232819](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603078232819.png)



###### CSS布局：弹性

未来布局的首选方案；

![1603078546425](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603078546425.png)

##### CSS盒子模型

![1603078579072](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603078579072.png)

##### CSS字体反爬

![1603078615554](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603078615554.png)



##### CSS背景反爬

![1603078680760](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603078680760.png)



#### 2. 为什么用CSS做反爬

为什么不用高大上的**JS加密、验证码等反爬技术**；而要用一些**非主流的CSS技术呢**？

##### CSS反爬的优点

![1603079333567](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603079333567.png)

![1603079378552](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603079378552.png)



![1603079500110](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603079500110.png)



#### 3.CSS反爬类型

![1603079584862](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603079584862.png)



##### 1. CSS字体反爬

左侧 html 中字体为 几个框框（数字）；

###### 案例1：大众点评网 评论

**参考：破解点评网字体反爬，深入挖掘系统背后的原理**

**1. 检查 查看字体**：**font-family**: '**PingFangSC-Regular-review**'

2. search 到 url("//s3plus.meituan.net/v1/mss_73a511b8f91f43d0bdae92584ea6330b/font/8fabbed4.woff



![1603079729000](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603079729000.png)





![1603079845582](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603079845582.png)



##### 2. CSS背景反爬

###### 案例2：雪碧图

**【Python3爬虫】大众点评爬虫（破解CSS反爬）**



![1603104457057](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603104457057.png)





![1603104549691](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603104549691.png)





##### 3.CSS伪类反爬



![1603109202168](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603109202168.png)

![1603115830932](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603115830932.png)





##### 4.CSS元素定位反爬

![1603115857835](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603115857835.png)



![1603115908268](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603115908268.png)





##### 5.CSS字符分割反爬

![1603115926522](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603115926522.png)

![1603115982855](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603115982855.png)





#### 4.CSS反爬应对的策略

CSS反爬应对的策略和玩方法非常多；

##### 1. CSSf反爬对应的策略步骤

![1603116091752](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603116091752.png)



#### 实战：

##### 1. 抓取机票价格（偏移量）

![1603118779982](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603118779982.png)

**绝对定位和偏移量 反爬**的一个措施；

简单抓取会得到一个错误的结果；

![1603116413450](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603116413450.png)



下面的 （32、16、48 ）- 48/16 =  偏移量的位置；120（103）=310

![1603116664222](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603116664222.png)

###### Puppeteer 案例

![1603117350807](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603117350807.png)





![1603117495479](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603117495479.png)

![1603117787278](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603117787278.png)





##### 2. 伪类反爬的例子 （汽车之家）

举个栗子吧： 小明有<span class="kw_01">头驴。

![1603118802838](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603118802838.png)



![1603118364412](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603118364412.png)



**商** 这个 隐藏在**before这个伪类**里面；

![1603118413899](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603118413899.png)



###### Puppeteer 代码

![1603118495807](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603118495807.png)



利用 **text = getComputedStyle(span, psedoEit: 'before').content** 来得到 **商**

![1603118565221](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603118565221.png)





![1603118733595](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603118733595.png)





### 33 十五 真假猴王——Base64竟有如此威⼒



![1603244163029](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603244163029.png)





**Window.atob作为Base64**的解码：   解开发现是**一堆乱码**；

也就是说看着像Base64,但并不是Base64的加密；

![1603244278570](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603244278570.png)



加载的为 Base64.JS；

![1603244472242](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603244472242.png)

断点跟踪到 run 方法；

document.getElementByID(id)操作；id为base64

![1603244575411](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603244575411.png)

发现**短的Base64编码是 长Base64编码的一部分**；

![1603245016740](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603245016740.png)



![1603245077326](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603245077326.png)



#### 1. 了解Base64的实现原理



#### 2. 拓展Base64实现自己的编码方式

![1603245505508](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603245505508.png)

![1603245279596](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603245279596.png)

![1603245556548](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603245556548.png)

![1603245844432](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603245844432.png)



**混淆编码**，但解码还是正确的**Base64**;

![1603245787325](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603245787325.png)

![1603245822028](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1603245822028.png)











### 34 逆向过程中遭遇加密算法，我该怎么办？



![34逆向过程中遭遇加密算法，我该怎么办？-000001](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000001.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000002](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000002.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000003](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000003.jpg)
![34逆向过程中遭遇加密算法，我该怎么办？-000004](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000004.jpg)
![34逆向过程中遭遇加密算法，我该怎么办？-000005](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000005.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000006](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000006.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000007](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000007.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000008](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000008.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000009](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000009.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000010](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000010.jpg)









![34逆向过程中遭遇加密算法，我该怎么办？-000011](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000011.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000012](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000012.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000013](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000013.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000014](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000014.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000015](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000015.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000016](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000016.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000017](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000017.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000018](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000018.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000019](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000019.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000020](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000020.jpg)

![34逆向过程中遭遇加密算法，我该怎么办？-000021](C:\Users\dell\Downloads\34逆向过程中遭遇加密算法，我该怎么办？\34逆向过程中遭遇加密算法，我该怎么办？-000021.jpg)

### 35 学逆向，你应该准备的JS语法知识都在这！

![35学逆向，你应该准备的JS语法知识都在这！-000001](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000001.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000002](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000002.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000003](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000003.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000004](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000004.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000005](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000005.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000006](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000006.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000007](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000007.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000008](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000008.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000009](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000009.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000010](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000010.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000011](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000011.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000012](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000012.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000013](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000013.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000014](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000014.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000015](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000015.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000016](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000016.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000017](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000017.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000018](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000018.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000019](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000019.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000020](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000020.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000021](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000021.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000022](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000022.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000023](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000023.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000024](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000024.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000025](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000025.jpg)

![35学逆向，你应该准备的JS语法知识都在这！-000026](C:\Users\dell\Downloads\35学逆向，你应该准备的JS语法知识都在这！\35学逆向，你应该准备的JS语法知识都在这！-000026.jpg)







### 36 Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！



![36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000001](C:\Users\dell\Downloads\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000001.jpg)

![36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000002](C:\Users\dell\Downloads\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000002.jpg)

![36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000003](C:\Users\dell\Downloads\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000003.jpg)

![36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000004](C:\Users\dell\Downloads\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000004.jpg)

![36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000005](C:\Users\dell\Downloads\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000005.jpg)

![36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000006](C:\Users\dell\Downloads\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000006.jpg)

![36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000007](C:\Users\dell\Downloads\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000007.jpg)

![36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000008](C:\Users\dell\Downloads\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000008.jpg)

![36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000009](C:\Users\dell\Downloads\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！\36Hook｜你带着老婆出了城，吃着火锅还唱着歌，突然就被麻匪劫了！-000009.jpg)



















































































































































































































































